# Lecture 20: Black-box optimization and reinforcement learning

### **1. 问题背景**

在本实验中，我们主要解决两个优化问题：

1. **最小二乘问题**：目标是通过随机搜索找到最优解，最小化目标函数。
2. **Himmelblau 函数优化**：通过随机搜索与 Nelder-Mead 方法寻找全局最优解。
   此外，实验实现了对 Flappy Bird 动态系统的模拟与策略优化，目标是通过优化奖励函数改进策略性能。

这些问题的核心在于：设计和分析优化算法，验证其性能并解决实际优化问题中的挑战。

------

### **2. 模型分析**

#### **2.1 最小二乘问题**

**目标函数**：

- $$
  f(x) = \frac{1}{2} \|Ax - b\|^2
  $$

  **性质**：

  - 凸函数：目标函数是二次型，其 Hessian 矩阵 `A^TA` 为半正定，因此 `f(x)` 是凸函数。

  - 光滑函数：`f(x)` 对 `x` 可微，且其梯度为 
    $$
    \nabla f(x) = A^T(Ax - b)
    $$
    ，梯度连续。

- **可行域**：
  定义在整个 R_n 空间。

#### **2.2 Himmelblau 函数**

**目标函数**：
$$
f(x_1, x_2) = (x_1^2 + x_2 - 11)^2 + (x_1 + x_2^2 - 7)^2
$$


- **性质**：

  - 非凸函数：目标函数存在多个局部极小值点，不满足凸函数性质。

  - 光滑函数：梯度连续，其一阶导数分别为： 
    $$
    \frac{\partial f}{\partial x_1} = 4x_1(x_1^2 + x_2 - 11) + 2(x_1 + x_2^2 - 7)
    $$

    $$
    \frac{\partial f}{\partial x_2} = 2(x_1^2 + x_2 - 11) + 4x_2(x_1 + x_2^2 - 7)
    $$

    

- **可行域**：
  定义在二维空间 R_2。

#### **2.3 Flappy Bird 动态系统**

状态由速度和高度 (v, h) 表示，通过策略 π 控制向上的加速度 aaa。
奖励函数为：
$$
R = \sum_t - a_t - \text{penalty for negative heights}
$$
目标是通过优化策略参数 θ 最大化奖励函数。

------

### **3. 优化方法**

#### **3.1 随机搜索**

- **描述**：
  在每次迭代中沿随机方向 d 搜索最优步长 η，使用黄金分割法在搜索区间内优化目标函数。
- **优点**：
  对目标函数的光滑性和凸性要求较低，适用于复杂和非凸问题。
- **缺点**：
  搜索效率较低，对初始点敏感。

#### **3.2 Nelder-Mead 算法**

- **描述**：
  通过单纯形顶点的扩展、收缩和缩放调整目标函数值，找到局部最优解。
- **优点**：
  适用于非凸和不光滑函数，无需计算梯度。
- **缺点**：
  局部搜索能力强，但容易陷入局部最优。

#### **3.3 Flappy Bird 策略优化**

策略为线性模型：
$$
\pi(s) = \theta^T s
$$
使用随机搜索优化参数 θ，目标是最大化奖励函数。

------

### **4. 数值实验**

#### **4.1 最小二乘问题**

随机搜索算法用于求解：

- **初始点**：随机生成的向量 b。
- **步长选择**：通过黄金分割法确定最优步长 η。
- **结果**：
  目标函数值逐渐下降，收敛性较好。

#### **4.2 Himmelblau 函数优化**

比较两种算法：

- 随机搜索和 Nelder-Mead 的目标值下降趋势表明：
  - Nelder-Mead 的收敛速度更快，但可能收敛到局部最优点。
  - 随机搜索能探索全局空间，找到更优解。

#### **4.3 Flappy Bird 模拟与优化**

- 初始策略表现较差，系统频繁坠落。
- 通过优化参数 θ，新策略显著提高了飞行高度和时间，奖励函数值增加。

------

### **5. 遇到的问题及解决办法**

1. **Matplotlib 图像绘制错误**
   - **问题**：调用 `gca(projection='3d')` 时出现 `TypeError`。
   - **原因**：`gca()` 不支持 `projection` 参数。
   - **解决办法**：使用 `add_subplot(111, projection='3d')` 替代。
2. **随机搜索收敛性不足**
   - **问题**：初始点导致收敛较慢。
   - **解决办法**：对搜索方向 d 和初始点进行标准化。

------

### **6. 结果分析**

- 解的质量：
  - 随机搜索在非凸问题上表现良好，找到较优解。
  - Nelder-Mead 在光滑非凸问题中更高效，但易陷入局部最优。
- 计算代价：
  - 随机搜索对计算资源需求较高。
  - Nelder-Mead 因无需梯度计算，整体代价较低。